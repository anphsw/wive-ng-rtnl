<head>
<title>ZVMODELVZ Web Manager</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<link rel="stylesheet" type="text/css" href="style.css" media="screen"></link>
<script language="JavaScript" type="text/javascript" src="overlib.js"></script>
<script language="JavaScript" type="text/javascript" src="general.js"></script>
<script language="JavaScript">
function ValidateChecksum(PIN)
{
	var accum = 0;

	accum += 3 * (parseInt(PIN / 10000000) % 10);
	accum += 1 * (parseInt(PIN / 1000000) % 10);
	accum += 3 * (parseInt(PIN / 100000) % 10);
	accum += 1 * (parseInt(PIN / 10000) % 10);
	accum += 3 * (parseInt(PIN / 1000) % 10);
	accum += 1 * (parseInt(PIN / 100) % 10);
	accum += 3 * (parseInt(PIN / 10) % 10);
	accum += 1 * (parseInt(PIN / 1) % 10);

	return ((accum % 10) == 0);
}

function PIN_PBC_Check()
{
	if (document.form.wps_mode[0].checked == true)
	{
		if(document.form.wps_pin.value != "")
		{
			if(document.form.wps_pin.value.length!=8 || !ValidateChecksum(document.form.wps_pin.value))
			{
				alert("<#JS_InvalidPIN#>");
				document.form.wps_pin.value="";
				document.form.wps_pin.focus();
				return false;
			}
			return onSubmitCtrl(this, 'WPS_apply');
		}
	}
	return onSubmitCtrl(this, 'WPS_apply');
}

var http_request = false;

function makeRequest(url) {
	http_request = new XMLHttpRequest();
	if (http_request && http_request.overrideMimeType)
		http_request.overrideMimeType('text/xml');
	else
		return false;

	http_request.onreadystatechange = alertContents;
	http_request.open('GET', url, true);
	http_request.send(null);
}

function alertContents()
{
	if (http_request != null && http_request.readyState != null && http_request.readyState == 4)
	{
		if (http_request.status != null && http_request.status == 200)
		{
			var xmldoc_mz = http_request.responseXML;
			refresh_wpsinfo(xmldoc_mz);
		}
	}
}

var xmlDoc_ie;

function makeRequest_ie(file)
{
	xmlDoc_ie = new ActiveXObject("Microsoft.XMLDOM");
	xmlDoc_ie.async = false;
	while(xmlDoc_ie.readyState != 4) {};

	xmlDoc_ie.load(file);
	refresh_wpsinfo(xmlDoc_ie);
}

function loadXML()
{
	var ie = window.ActiveXObject;

	if (ie)
		makeRequest_ie('WPS_info.asp');
	else
		makeRequest('WPS_info.asp');

	setTimeout('loadXML()',1000);
}

function refresh_wpsinfo(xmldoc)
{
	if (xmldoc.getElementsByTagName("wps")==null)
		return;
	var wpss=xmldoc.getElementsByTagName("wps");
	if (wpss==null || wpss[0]==null)
		return;
	var wps_infos=wpss[0].getElementsByTagName("wps_info");

	if(nav)
	{
		if (document.form.wps_enable_old.value=="0")
			document.getElementById("wps_status_current").innerHTML="Not used";
		else
			document.getElementById("wps_status_current").innerHTML=wps_infos[0].firstChild.nodeValue;
		document.getElementById("wps_conf").innerHTML=wps_infos[1].firstChild.nodeValue;
		document.getElementById("wps_ssid").innerHTML=decodeURIComponent(wps_infos[2].firstChild.nodeValue);
		document.getElementById("wps_auth_mode").innerHTML=wps_infos[3].firstChild.nodeValue;
		document.getElementById("wps_crypto").innerHTML=wps_infos[4].firstChild.nodeValue;
		document.getElementById("wps_key").innerHTML=wps_infos[5].firstChild.nodeValue;
		if (wps_infos[6].firstChild.nodeValue=="NONE")
		{
			if (wps_infos[0].firstChild.nodeValue=="Yes")
				document.getElementById("wps_wpa_psk").innerHTML=wps_infos[8].firstChild.nodeValue;
			else
				document.getElementById("wps_wpa_psk").innerHTML="&nbsp;";
		}
		else
			document.getElementById("wps_wpa_psk").innerHTML=wps_infos[6].firstChild.nodeValue;
		document.getElementById("wps_pin_ap").innerHTML=wps_infos[7].firstChild.nodeValue;
	}
	else
	{
		if (document.form.wps_enable_old.value=="0")
			document.getElementById("wps_status_current").innerText="Not used";
		else
			document.getElementById("wps_status_current").innerText=wps_infos[0].firstChild.nodeValue;
		document.getElementById("wps_conf").innerText=wps_infos[1].firstChild.nodeValue;
		document.getElementById("wps_ssid").innerText=decodeURIComponent(wps_infos[2].firstChild.nodeValue);
		document.getElementById("wps_auth_mode").innerText=wps_infos[3].firstChild.nodeValue;
		document.getElementById("wps_crypto").innerText=wps_infos[4].firstChild.nodeValue;
		document.getElementById("wps_key").innerText=wps_infos[5].firstChild.nodeValue;
		if (wps_infos[6].firstChild.nodeValue=="NONE")
		{
			if (wps_infos[0].firstChild.nodeValue=="Yes")
				document.getElementById("wps_wpa_psk").innerText=wps_infos[8].firstChild.nodeValue;
			else
				document.getElementById("wps_wpa_psk").innerText=" ";
		}
		else
			document.getElementById("wps_wpa_psk").innerText=wps_infos[6].firstChild.nodeValue;
		document.getElementById("wps_pin_ap").innerText=wps_infos[7].firstChild.nodeValue;
	}
	if (document.form.WL_auth_mode.value=="wpa" || document.form.WL_auth_mode.value=="radius")
	{
		document.form.wps_enable[0].disabled=1;
		document.form.wps_enable[1].disabled=1;
		document.form.wps_mode[0].disabled=1;
		document.form.wps_mode[1].disabled=1;
		inputCtrl(document.form.wps_pin, 0);
		document.form.WPS_apply.disabled=1;
		document.form.Reset_OOB.disabled=1;
		return;
	}
	if (wps_infos[9].firstChild.nodeValue!=document.form.wps_enable_old.value)
	{
		document.form.wps_enable_old.value=wps_infos[9].firstChild.nodeValue;
		if (wps_infos[9].firstChild.nodeValue=="1")
		{
			document.form.wps_enable[0].checked = true;
			document.form.wps_enable[1].checked = false;

			document.form.wps_mode[0].disabled=0;
			document.form.wps_mode[1].disabled=0;
			if (document.form.wps_mode[1].checked == true)
				inputCtrl(document.form.wps_pin, 1);
			else
				inputCtrl(document.form.wps_pin, 0);

			if (document.form.wps_enable_old.value=="1")
				document.form.Reset_OOB.disabled=0;
		}
		else
		{
			document.form.wps_enable[0].checked = false;
			document.form.wps_enable[1].checked = true;

			document.form.wps_mode[0].disabled=1;
			document.form.wps_mode[1].disabled=1;
			inputCtrl(document.form.wps_pin, 0);
			document.form.Reset_OOB.disabled=1;
		}
	}
	if (wps_infos[10].firstChild.nodeValue!=document.form.wps_mode_old.value)
	{
		document.form.wps_mode_old.value=wps_infos[10].firstChild.nodeValue;
		document.form.wps_mode[0].disabled=0;
		document.form.wps_mode[1].disabled=0;

		if (wps_infos[10].firstChild.nodeValue=="2")
		{
			document.form.wps_mode[0].checked=true;
			document.form.wps_mode[1].checked=false;
			inputCtrl(document.form.wps_pin, 0);
		}
		else
		{
			document.form.wps_mode[0].checked=false;
			document.form.wps_mode[1].checked=true;
			inputCtrl(document.form.wps_pin, 1);
		}

		if (document.form.wps_enable[1].checked == true)
		{
			document.form.wps_mode[0].disabled=1;
			document.form.wps_mode[1].disabled=1;
		}
	}
}

</script>
</head>  
<div id="overDiv" style="position:absolute; visibility:hidden; z-index:1000;"></div>    
<body onLoad="load_body();loadXML();" onunLoad="return unload_body();">
<form method="GET" name="form" action="apply.cgi">
<!-- Table for the conntent page -->	    
<table width="666" border="0" cellpadding="0" cellspacing="0">     	      
    	
<input type="hidden" name="current_page" value="Advanced_WWPS_Content.asp">
<input type="hidden" name="next_page" value="Advanced_WWPS_Content.asp">
<input type="hidden" name="next_host" value="">
<input type="hidden" name="sid_list" value="WLANConfig11b;">
<input type="hidden" name="group_id" value="">
<input type="hidden" name="modified" value="0">
<input type="hidden" name="action_mode" value="">
<input type="hidden" name="first_time" value="">
<input type="hidden" name="action_script" value="">
<input type="hidden" name="preferred_lang" value="<% nvram_get_x("", "preferred_lang"); %>">
<input type="hidden" name="wps_enable_old" value="<% nvram_get_x("WLANConfig11b", "wps_enable"); %>">
<input type="hidden" name="wps_mode_old" value="<% nvram_get_x("WLANConfig11b", "wps_mode"); %>">
<input type="hidden" name="WL_auth_mode" value="<% nvram_get_x("", "WL_auth_mode"); %>">

<tr>
<td>
<table width="666" border="1" cellpadding="0" cellspacing="0" bordercolor="E0E0E0">
<tr class="content_header_tr">
<td class="content_header_td_title" colspan="2"><#t1Wireless#> - <#t2WPS#></td>
</tr>
<tr>
<td class="content_desc_td" colspan="2"><#WLANConfig11b_display6_sectiondesc#></td>
</tr>
</table>
</td>
</tr>

<tr>
<td>
<table width="666" border="1" cellpadding="0" cellspacing="0" bordercolor="E0E0E0">
<tr class="content_section_header_tr">
	<td class="content_section_header_td" colspan="2"><#WLANConfig11b_x_WPSConf_sectiondesc#></td>
</tr>

<tr>
	<td class="content_header_td_less" onMouseOver="return overlib('<#WLANConfig11b_x_WPS_itemdesc#>', LEFT);" onMouseOut="return nd();"><#WLANConfig11b_x_WPS_itemname#></td>
	<td class="content_input_td">
		<input type="radio" value="1" name="wps_enable" class="content_input_fd" onClick="return change_common_radio(this, 'WLANConfig11b', 'wps_enable', '1')" <% nvram_match_x("WLANConfig11b","wps_enable", "1", "checked"); %>>Yes</input>
		<input type="radio" value="0" name="wps_enable" class="content_input_fd" onClick="return change_common_radio(this, 'WLANConfig11b', 'wps_enable', '0')" <% nvram_match_x("WLANConfig11b","wps_enable", "0", "checked"); %>>No</input>
	</td>
</tr>

<tr>
	<td class="content_header_td_less" onMouseOver="return overlib('<#WLANConfig11b_x_WPSMode_itemdesc#>', LEFT);" onMouseOut="return nd();"><#WLANConfig11b_x_WPSMode_itemname#></td>
	<td class="content_input_td">
		<input type="radio" value="2" name="wps_mode" class="content_input_fd" onClick="return change_common_radio(this, 'WLANConfig11b', 'wps_mode', '2')" <% nvram_match_x("WLANConfig11b","wps_mode", "2", "checked"); %>>PBC</input>
		<input type="radio" value="1" name="wps_mode" class="content_input_fd" onClick="return change_common_radio(this, 'WLANConfig11b', 'wps_mode', '1')" <% nvram_match_x("WLANConfig11b","wps_mode", "1", "checked"); %>>PIN</input>
	</td>
</tr>

<tr>
	<td class="content_header_td_less" onMouseOver="return overlib('<#WLANConfig11b_x_WPSPIN_itemdesc#>', LEFT);" onMouseOut="return nd();"><#WLANConfig11b_x_WPSPIN_itemname#></td>
	<td class="content_input_td">
		<input type="text" size="8" maxlength="8" class="content_input_fd" name="wps_pin" value="<% nvram_get_f("wps.log","wps_pin"); %>" onKeyPress="return is_number_sp(event, this);">
	</td>
</tr>

<tr>
	<td class="content_header_td_less">&nbsp;</td>
	<td class="content_input_td">
		<input class="inputSubmit" type="submit" onClick="return PIN_PBC_Check();" name="WPS_apply" value="  <#CTL_apply#>  ">&nbsp;
		<input class="inputSubmit" type="submit" onClick="return onSubmitCtrl(this, 'Reset_OOB');" name="Reset_OOB" value="<#CTL_Reset_OOB#>">
	</td>
</tr>

</table>
</td>
</tr>

<tr>
<td>
<table width="666" border="2" cellpadding="0" cellspacing="0" bordercolor="E0E0E0"></table>
</td>
</tr>

<tr>
<td>
<table width="666" border="1" cellpadding="0" cellspacing="0" bordercolor="E0E0E0">
<tr class="content_section_header_tr">
	<td class="content_section_header_td" colspan="2"><#WLANConfig11b_x_WPSInfo_sectiondesc#></td>
</tr>

<tr>
	<td class="content_header_td_less"><#WLANConfig11b_x_WPSStatus_itemname#></td>
	<td class="content_input_td">
		<span id="wps_status_current">&nbsp;</span>
	</td>
</tr>

<tr>
	<td class="content_header_td_less"><#WLANConfig11b_x_WPSConf_itemname#></td>
	<td class="content_input_td">
		<span id="wps_conf">&nbsp;</span>
	</td>
</tr>

<tr>
	<td class="content_header_td_less"><#WLANConfig11b_x_WPSSSID_itemname#></td>
	<td class="content_input_td">
		<span id="wps_ssid">&nbsp;</span>
	</td>
</tr>

<tr>
	<td class="content_header_td_less"><#WLANConfig11b_x_WPSAuthMode_itemname#></td>
	<td class="content_input_td">
		<span id="wps_auth_mode">&nbsp;</span>
	</td>
</tr>

<tr>
	<td class="content_header_td_less"><#WLANConfig11b_x_WPSEncType_itemname#></td>
	<td class="content_input_td">
		<span id="wps_crypto">&nbsp;</span>
	</td>
</tr>

<tr>
	<td class="content_header_td_less"><#WLANConfig11b_x_WPSKeyIndex_itemname#></td>
	<td class="content_input_td">
		<span id="wps_key">&nbsp;</span>
	</td>
</tr>

<tr>
	<td class="content_header_td_less"><#WLANConfig11b_x_WPSKey_itemname#></td>
	<td class="content_input_td">
		<span id="wps_wpa_psk">&nbsp;</span>
	</td>
</tr>

<tr>
	<td class="content_header_td_less"><#WLANConfig11b_x_WPSAPPIN_itemname#></td>
	<td class="content_input_td">
		<span id="wps_pin_ap">&nbsp;</span>
	</td>
</tr>

</table>
</td>
</tr>

<tr>
<td>		
<table width="666" border="1" cellpadding="0" cellspacing="0" bordercolor="B0B0B0">
<tr bgcolor="#CCCCCC"><td colspan="3"><font face="arial" size="2"><b>&nbsp</b></font></td></tr>
<tr bgcolor="#FFFFFF">  
   <td height="25" width="34%">  
   </td>
   <td height="25" width="33%">  
   </td>
   <td height="25" width="33%">
   </td>
</tr>
</table>
</td>
</tr>

</table>
</form>
</body>
