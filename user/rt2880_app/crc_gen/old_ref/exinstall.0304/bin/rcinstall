#!/bin/msh

POOL=`nvram get apps_pool`
SHARE=`nvram get apps_share`
ORIGVER=`nvram get apps_ver`
TARGETDIR="shares/${POOL}/${SHARE}"
POOLDIR="shares/${POOL}"

EXLIB=/tmp/harddisk/part0/apps/lib
EXBIN=/tmp/harddisk/part0/apps/bin
EXUSR=/tmp/harddisk/part0/apps/usr
#EXWWW=tmp/harddisk/part0/apps/www
EXETC=/${POOLDIR}/etc

rm -rf /shares/lib
rm -rf /shares/bin
rm -rf /shares/usr
#rm -rf /shares/wwwapps
rm -rf /shares/etc
rm -rf /shares/${POOL}/etc

#add by jiahao_jhou
mkdir /${POOLDIR}
mkdir /${TARGETDIR}

ln -s $EXLIB /shares/lib
ln -s $EXBIN /shares/bin
ln -s $EXUSR /shares/usr
#ln -s $EXWWW /shares/wwwapps
ln -s $EXBIN /shares/${POOL}/bin

current_dir=`pwd`
cd /shares/bin
./rcver
NEWVER=`nvram get apps_ver`

#if [ -d "/${TARGETDIR}/Music" ]; then
#	echo "Music DIR exist"
#else
	mkdir /${TARGETDIR}/Music
#	chown guest:root /${TARGETDIR}/Music -R
#fi
#
#if [ -d "/${TARGETDIR}/Video" ]; then
#	echo "Video DIR exist"
#else
	mkdir /${TARGETDIR}/Video
#	chown guest:root /${TARGETDIR}/Video -R
#fi
#
#if [ -d "/${TARGETDIR}/Photo" ]; then
#	echo "Photo DIR exist"
#else
	mkdir /${TARGETDIR}/Photo
#	chown guest:root /${TARGETDIR}/Photo -R
#fi

#if [ -d "/${TARGETDIR}/Download" ]; then
#	echo "Download DIR exist"
#	if [ -d "/${TARGETDIR}/Download/config" ]; then
#		mkdir /${TARGETDIR}/Download/config
#		chown guest:root /${TARGETDIR}/Download/config -R
#	else
#		chown guest:root /${TARGETDIR}/Download/config -R
#	fi
#	if [ -d "/${TARGETDIR}/Download/Complete" ]; then
#		mkdir /${TARGETDIR}/Download/Complete
#		chown guest:root /${TARGETDIR}/Download/Complete -R
#	else
#		chown guest:root /${TARGETDIR}/Download/Complete -R
#	fi
#	if [ -d "/${TARGETDIR}/Download/InComplete" ]; then
#		mkdir /${TARGETDIR}/Download/InComplete
#		chown guest:root /${TARGETDIR}/Download/InComplete -R
#	else
#		chown guest:root /${TARGETDIR}/Download/InComplete -R
#	fi
#else
	mkdir /${TARGETDIR}/Download
#	chown guest:root /${TARGETDIR}/Download -R
	mkdir /${TARGETDIR}/Download/config
#	chown guest:root /${TARGETDIR}/Download/config -R
	mkdir /${TARGETDIR}/Download/Complete
#	chown guest:root /${TARGETDIR}/Download/Complete -R
	mkdir /${TARGETDIR}/Download/InComplete
#	chown guest:root /${TARGETDIR}/Download/InComplete -R
#fi


#if [ -d "${EXETC}" ]; then
#	echo "DIR exist"
#else
	rm -rf /${EXETC}
	mkdir /${EXETC}
	ln -s /${EXETC} /shares/etc
#	chown guest:root /${EXETC} -R
	
#	if [ -f "/${EXETC}/asus_gift.conf" ]; then
#		echo "File exist"
#	else
		cp /${EXUSR}/gift-nasoc/bin/asus_gift.conf /${EXETC}/. -f
#	fi
	
#	if [ -d "/${EXETC}/.giFT" ]; then
#		echo ".giFT DIR exist"
#	else
		#rm -rf ${EXETC}/.giFT
		#mv /shares/usr/.giFT /${EXETC}/.
		mkdir /${EXETC}/.giFT
		cp /shares/usr/.giFT/* /${EXETC}/.giFT/. -f
		mkdir /${EXETC}/.giFT/FastTrack
		cp /shares/usr/.giFT/FastTrack/* /${EXETC}/.giFT/FastTrack/. -f
		mkdir /${EXETC}/.giFT/OpenFT
		cp /shares/usr/.giFT/OpenFT/* /${EXETC}/.giFT/OpenFT/. -f
		mkdir /${EXETC}/.giFT/Gnutella
		cp /shares/usr/.giFT/Gnutella/* /${EXETC}/.giFT/Gnutella/. -f
		mkdir /${EXETC}/.giFT/completed
		mkdir /${EXETC}/.giFT/completed/corrupted
		mkdir /${EXETC}/.giFT/ui
		cp /shares/usr/.giFT/ui/* /${EXETC}/.giFT/ui/. -f
		#ln -s /shares/usr/gift-nasoc /${EXETC}/gift-nasoc
		
		mkdir /${EXETC}/giFT
		#mkdir /${EXETC}/gift-nasoc
		cp /shares/usr/gift-nasoc/share/giFT/* /${EXETC}/giFT/. -f
		mkdir /${EXETC}/giFT/FastTrack
#		cp /shares/usr/gift-nasoc/share/giFT/FastTrack/* /${EXETC}/giFT/FastTrack/. -f
		mkdir /${EXETC}/giFT/OpenFT
#		cp /shares/usr/gift-nasoc/share/giFT/OpenFT/* /${EXETC}/giFT/OpenFT/. -f
		mkdir /${EXETC}/giFT/Gnutella
#		cp /shares/usr/gift-nasoc/share/giFT/Gnutella/* /${EXETC}/giFT/Gnutella/. -f
		mkdir /${EXETC}/giFT/completed
		mkdir /${EXETC}/giFT/completed/corrupted
		mkdir /${EXETC}/giFT/ui
		cp /shares/usr/gift-nasoc/share/giFT/ui/* /${EXETC}/giFT/ui/. -f
#	fi
#fi
#rm -rf ${EXBIN}/rungshell
#ln -s /shares/usr/gift-nasoc/bin/gshell /${EXBIN}/rungshell
rm -rf /shares/DMSRoot
mkdir /shares/DMSRoot
ln -s /${TARGETDIR}/Download/Complete /shares/DMSRoot/Download
ln -s /${TARGETDIR}/USBCopy /shares/DMSRoot/USBCopy
ln -s /${TARGETDIR}/Video /shares/DMSRoot/Video
ln -s /${TARGETDIR}/Music /shares/DMSRoot/Music
ln -s /${TARGETDIR}/Photo /shares/DMSRoot/Photo
#ln -s /${TARGETDIR}/web/PhotoAlbum /shares/DMSRoot/PhotoAlbum

# rerun
./rcex
#killall httpd
cd ${current_dir}
