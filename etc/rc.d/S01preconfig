#!/bin/sh

#include kernel config
. /etc/scripts/config.sh

#only clean load start this
if [ -f /var/run/goahead.pid ]; then
    exit 0
fi

LOG="echo PRECONFIG: "

start() {
 $LOG "Preconfigure..."
    export PATH=.:$PATH:/bin:/sbin:/usr/bin:/usr/sbin:/etc/scripts

    $LOG "Delete old config"
    rm -f /etc/zebra.conf
    rm -f /etc/ripd.conf

    $LOG "Mount all filesystems"
    mount -a
    mount -t devpts /dev/pts /dev/pts
    mknod /dev/ptmx c 5 2
    
    $LOG "Create some folders"
    mkdir -p /var/run
    mkdir -p /var/lock
    mkdir -p /var/lock/subsys
    mkdir -p /var/log
    mkdir -p /var/tmp
    mkdir -p /var/run/xl2tpd
    mkdir -p /dev/pty

    mknod /dev/pty/m0             c       2       0
    mknod /dev/pty/m1             c       2       1
    mknod /dev/pty/m2             c       2       2
    mknod /dev/pty/m3             c       2       3
    mknod /dev/pty/m4             c       2       4
    mknod /dev/pty/m5             c       2       5
    mknod /dev/pty/m6             c       2       6
    mknod /dev/pty/m7             c       2       7
    mknod /dev/pty/m8             c       2       8
    mknod /dev/pty/m9             c       2       9
    mknod /dev/pty/m10    c       2       10
    mknod /dev/pty/m11    c       2       11
    mknod /dev/pty/m12    c       2       12
    mknod /dev/pty/m13    c       2       13
    mknod /dev/pty/m14    c       2       14
    mknod /dev/pty/m15    c       2       15

    mkdir -p /dev/tts
    mknod /dev/tts/0              c       4       64
    mknod /dev/tts/1              c       4       65

    mkdir -p /dev/cua
    mknod /dev/cua/0              c       5       64

    mkdir -p /dev/misc
    mknod /dev/misc/rtc   c       10      135

    #modify permissions
    chmod 777 /tmp
    
#if compile date fille is exist
if [ -f /etc/compile-date ]; then
    $LOG "Restore time to build time or save time"
    BUILDDATE=`cat /etc/compile-date`
    if [ "$BUILDDATE" != "" ]; then
	date -s $BUILDDATE
    fi
fi

$LOG "Copy web pages to tmpfs"
    mkdir -p /tmp/web
    cp -rpf /web/* /tmp/web

}

stop() {
 echo "" > /dev/null
}

case "$1" in
	start)
	    start
	    ;;

	stop)
	    stop
	    ;;

	restart)
	    stop
	    start
	    ;;

	*)
	    echo $"Usage: $0 {start|stop|restart}"
	    exit 1
esac
