#!/bin/sh

#get params
. /etc/scripts/global.sh

LOG="echo DNSSERVER: "

start() {
dnsp=`nvram_get 2860 dnsPEnabled`
    if [ -f /bin/dnsmasq ] && [ "$dnsp" = "1" ]; then
     get_param
     $LOG "Starting DNSMASQ: "
     if [ -f /etc/dnsmasq.conf ]; then
	/bin/dnsmasq  -u $admID -g $admID -C /etc/dnsmasq.conf -r $fname -H /etc/hosts -f -I $wan_if
     fi 
    fi
}

stop() {
 $LOG "Stopping DNSMASQ: "
  killall -q dnsmasq
  killall -q -9 dnsmasq
  rm -rf /var/run/dnsmasq.pid > /dev/null 2>&1
}

get_param() {
    admID=`nvram_get 2860 Login`
    fname="/etc/resolv.conf"
}

case "$1" in
        start)
            start
            ;;

        stop)
            stop
            ;;

        restart)
            stop
            start
            ;;

        *)
            echo $"Usage: $0 {start|stop|restart}"
            exit 1
esac
